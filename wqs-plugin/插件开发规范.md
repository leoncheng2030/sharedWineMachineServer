# 插件开发规范（以wqs-plugin-biz为例）

## 1. 插件创建流程规范

### 1.1 创建顺序
- 创建插件目录时，应按以下顺序进行：
  1. 首先创建插件主目录（如`wqs-plugin-xxx`）
  2. 优先创建插件主目录的`pom.xml`文件
  3. 创建对应的API目录（如`wqs-plugin-xxx-api`）
  4. 创建API目录的`pom.xml`文件
  5. 更新父级pom文件的模块配置
  6. 创建源码目录结构

### 1.2 pom文件创建和更新要求
- **插件主目录pom.xml**：
  - 继承自`wqs-plugin`父模块
  - 设置正确的`artifactId`、`packaging`、`description`
  - 配置必要的依赖关系（自身API模块、其他插件API模块等）

- **API目录pom.xml**：
  - 继承自`wqs-plugin-api`父模块
  - 设置正确的`artifactId`、`packaging`、`description`
  - 配置必要的依赖关系（wqs-common、其他插件API模块等）

- **更新父级pom配置**：
  - 在`wqs-plugin/pom.xml`中添加新插件模块
  - 在`wqs-plugin-api/pom.xml`中添加新API模块
  - 在根目录`pom.xml`中添加版本管理配置
  - 在主启动模块（如`sharedWineMachineServer/pom.xml`）中添加新插件和API模块的版本管理
  - 在启动模块（如`wqs-web-app/pom.xml`）中添加新插件的依赖，确保插件能被正确加载和启动

### 1.3 创建示例
```xml
<!-- 1. 创建wqs-plugin-xxx/pom.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>vip.wqs</groupId>
        <artifactId>wqs-plugin</artifactId>
        <version>3.0.0</version>
    </parent>

    <artifactId>wqs-plugin-xxx</artifactId>
    <packaging>jar</packaging>
    <description>XXX功能插件</description>

    <dependencies>
        <!-- 必须依赖自己的API -->
        <dependency>
            <groupId>vip.wqs</groupId>
            <artifactId>wqs-plugin-xxx-api</artifactId>
        </dependency>
        
        <!-- 其他依赖... -->
    </dependencies>
</project>
```

```xml
<!-- 2. 创建wqs-plugin-xxx-api/pom.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>vip.wqs</groupId>
        <artifactId>wqs-plugin-api</artifactId>
        <version>3.0.0</version>
    </parent>

    <artifactId>wqs-plugin-xxx-api</artifactId>
    <packaging>jar</packaging>
    <description>XXX功能插件API</description>

    <dependencies>
        <!-- API可以依赖公共模块 -->
        <dependency>
            <groupId>vip.wqs</groupId>
            <artifactId>wqs-common</artifactId>
        </dependency>
        
        <!-- 其他API依赖... -->
    </dependencies>
</project>
```

```xml
<!-- 3. 更新启动模块wqs-web-app/pom.xml -->
<dependencies>
    <!-- 现有依赖... -->
    
    <!-- 新增插件依赖 -->
    <dependency>
        <groupId>vip.wqs</groupId>
        <artifactId>wqs-plugin-xxx</artifactId>
    </dependency>
    
    <!-- 其他依赖... -->
</dependencies>
```

```xml
<!-- 4. 更新主启动模块sharedWineMachineServer/pom.xml -->
<dependencyManagement>
    <dependencies>
        <!-- 现有版本管理... -->
        
        <!-- 新增插件版本管理 -->
        <dependency>
            <groupId>vip.wqs</groupId>
            <artifactId>wqs-plugin-xxx</artifactId>
            <version>${project.version}</version>
        </dependency>
        
        <dependency>
            <groupId>vip.wqs</groupId>
            <artifactId>wqs-plugin-xxx-api</artifactId>
            <version>${project.version}</version>
        </dependency>
        
        <!-- 其他版本管理... -->
    </dependencies>
</dependencyManagement>
```

## 2. 目录结构规范

- 每个插件应有独立的目录，命名为`wqs-plugin-xxx`，如`wqs-plugin-biz`。
- 插件下应包含如下标准目录结构（以业务插件为例，文件名需与业务一致）：
  ```
  wqs-plugin-xxx/
    ├── pom.xml
    ├── README.md
    └── src/
        └── main/
            ├── java/
            │   └── vip/
            │       └── wqs/
            │           └── biz/
            │               ├── core/
            │               │   ├── config/
            │               │   │   └── BizConfigure.java
            │               │   └── enums/
            │               └── modular/
            │                   └── user/
            │                       ├── controller/
            │                       │   └── BizUserController.java
            │                       ├── service/
            │                       │   ├── BizUserService.java
            │                       │   └── impl/
            │                       │       └── BizUserServiceImpl.java
            │                       ├── entity/
            │                       │   └── BizUser.java
            │                       ├── mapper/
            │                       │   ├── BizUserMapper.java
            │                       │   └── mapping/
            │                       │       └── BizUserMapper.xml
            │                       ├── param/
            │                       │   ├── BizUserAddParam.java
            │                       │   ├── BizUserEditParam.java
            │                       │   ├── BizUserIdParam.java
            │                       │   ├── BizUserPageParam.java
            │                       ├── result/
            │                       │   └── BizUserExportResult.java
            │                       └── enums/
            │                           └── BizUserStatusEnum.java
            └── resources/
                ├── config/
                │   └── biz-config.yml
                └── userExportTemplate.docx
  ```
- 说明：
  - 配置类应放在`core/config/`目录下，如`core/config/BizConfigure.java`。
  - 配置文件（如yml）推荐放在`resources/config/`下。
  - `mapper/`目录下可有多个`*Mapper.java`接口文件。
  - `mapper/mapping/`目录下为对应的`*Mapper.xml`文件（MyBatis映射文件）。
  - 推荐将xml文件与java一起放在`java/mapper/mapping/`下，需保证配置正确。
  - 其他如service、entity、param、result、enums等目录下均可有多个相关文件，命名需与业务紧密相关。

- API模块目录结构示例（参考wqs-plugin-auth-api实际结构）：
  ```
  wqs-plugin-xxx-api/
    ├── pom.xml
    ├── README.md
    └── src/
        └── main/
            └── java/
                └── vip/
                    └── wqs/
                        └── biz/
                            ├── package-info.java
                            ├── api/
                            │   ├── BizUserApi.java
                            │   └── BizOrgApi.java
                            └── core/
                                ├── annotation/
                                │   └── BizCheckPermission.java
                                ├── enums/
                                │   └── BizUserStatusEnum.java
                                ├── pojo/
                                │   ├── BizUserInfo.java
                                │   └── BizOrgInfo.java
                                └── util/
                                    └── BizUtil.java
  ```
  - 说明：
    - `api/`目录专门存放对外接口定义，如`BizUserApi.java`。
    - `core/`目录存放支撑类，包括注解（annotation）、枚举（enums）、数据对象（pojo）、工具类（util）等。
    - API模块只包含接口定义和必要的支撑类，不包含controller、service impl、entity、mapper等实现层代码。

## 3. 插件配置开发规范

- 插件应将所有可配置参数集中在`core/config/`目录下，包含Java配置类（如`BizConfigure.java`）和YAML/Properties等配置文件（如`biz-config.yml`）。
- 配置类应有详细注释，说明每个参数的用途、默认值、可选值等。
- 配置文件应采用清晰的命名和分层结构，便于环境切换和参数管理。
- 插件应通过依赖注入等方式读取配置，避免硬编码。
- 配置变更应有热加载或重启生效机制，确保灵活性和安全性。

## 4. API模块检查规范

- 开发插件前，需先检查对应的插件API模块（如`wqs-plugin-xxx-api`）是否已存在。
- 若API模块不存在，需先创建API模块，定义好对外接口，确保插件与其他模块解耦、便于扩展。

## 5. 插件API模块开发规范

- **目录结构**：API模块应包含`api/`目录（存放接口）和`core/`目录（存放支撑类），参考`wqs-plugin-auth-api`结构。
- **命名规范**：API模块名、包名、接口名需与插件主体保持一致，接口类名建议以`Api`结尾，如`BizUserApi`。
- **依赖规范**：API模块应只包含接口定义和必要的支撑类（annotation、enums、pojo、util），不应包含具体实现和第三方依赖，保持轻量、无业务逻辑。
- **接口设计**：
  - `api/`目录只定义对外暴露的服务接口，方法需有详细注释。
  - `core/`目录存放支撑类，如注解、枚举、数据对象、工具类等。
  - 接口方法应简洁、单一职责，便于后续扩展和维护。
- **注释与文档**：
  - 每个接口、方法、参数、返回值需有清晰注释，说明用途、作者、日期等。
  - API模块根目录下需有`README.md`，简要说明API用途、接口列表、参数说明等。
- **版本管理**：如API有重大变更，需通过包名或接口注释标明版本信息，确保兼容性。

## 6. 依赖与构建规范

- 每个插件需有独立的`pom.xml`，继承自`wqs-plugin`父模块。
- 插件打包类型为`jar`。

### 6.1 插件与API模块依赖关系

- **插件主体依赖规范**：
  - 插件主体（如`wqs-plugin-biz`）必须依赖自身API模块（如`wqs-plugin-biz-api`）。
  - 插件主体可依赖其他插件的API模块（如依赖`wqs-plugin-auth-api`、`wqs-plugin-sys-api`等），但严禁直接依赖其他插件的实现模块。
  - 插件主体不允许依赖公共模块（如`wqs-common`）。

- **API模块依赖规范**：
  - API模块应保持轻量，只依赖必要的基础库（如Spring、Hutool等）。
  - API模块可以依赖公共模块（如`wqs-common`）。
  - API模块之间可以相互依赖，但需避免循环依赖。
  - API模块不应依赖任何插件的实现模块。

- **依赖示例**（以biz插件为例）：
  ```xml
  <!-- wqs-plugin-biz的pom.xml -->
  <dependencies>
      <!-- 必须依赖自身API模块 -->
      <dependency>
          <groupId>vip.wqs</groupId>
          <artifactId>wqs-plugin-biz-api</artifactId>
      </dependency>
      
      <!-- 可依赖其他插件的API模块 -->
      <dependency>
          <groupId>vip.wqs</groupId>
          <artifactId>wqs-plugin-auth-api</artifactId>
      </dependency>
      
      <dependency>
          <groupId>vip.wqs</groupId>
          <artifactId>wqs-plugin-sys-api</artifactId>
      </dependency>
      
      <!-- 插件主体不允许依赖wqs-common -->
      <!-- <dependency>
          <groupId>vip.wqs</groupId>
          <artifactId>wqs-common</artifactId>
      </dependency> -->
  </dependencies>
  ```

  ```xml
  <!-- wqs-plugin-biz-api的pom.xml -->
  <dependencies>
      <!-- API模块可以依赖公共模块 -->
      <dependency>
          <groupId>vip.wqs</groupId>
          <artifactId>wqs-common</artifactId>
      </dependency>
      
      <!-- 可依赖其他插件的API模块 -->
      <dependency>
          <groupId>vip.wqs</groupId>
          <artifactId>wqs-plugin-auth-api</artifactId>
      </dependency>
  </dependencies>
  ```

### 6.2 版本管理与依赖控制

- **版本统一**：所有插件及其API模块的版本号应保持一致，由父模块统一管理。
- **循环依赖避免**：严禁插件之间形成循环依赖，如A插件依赖B插件API，则B插件不能依赖A插件API。
- **依赖范围控制**：
  - 编译时依赖：API模块、公共模块
  - 运行时依赖：数据库驱动、第三方服务等
  - 测试依赖：单元测试框架等
- **依赖传递管理**：使用`<dependencyManagement>`统一管理依赖版本，避免版本冲突。

## 7. 代码分层规范

- **controller**：负责接口暴露，类名以`Controller`结尾，需加详细注释，使用Swagger/OpenAPI注解，权限注解，日志注解等。
- **service**：业务逻辑层，接口与实现分离，接口以`Service`结尾，注释完整。
- **entity**：实体类，映射数据库表，字段注释齐全。
- **mapper**：MyBatis Mapper接口，负责数据库操作。
- **param/result**：参数和返回对象，便于接口入参和出参解耦。
- **enums**：枚举类，统一管理业务相关枚举。
- **config**：配置类和配置文件，集中管理插件参数。

## 8. 注释与文档规范

- 每个类、方法、字段必须有清晰的注释，说明用途、作者、日期等。
- 重要接口需有Swagger注解，便于自动生成API文档。
- 插件根目录下需有`README.md`，简要说明插件功能、用途、接口说明等。

## 9. 命名规范

- 包名、类名、方法名、参数名均采用小写+驼峰或下划线分隔，见名知意。
- 控制器类名如`BizUserController`，服务类名如`BizUserService`，实体类名如`BizUser`。

## 10. 安全与日志

- 需使用权限注解（如`@SaCheckPermission`）保护接口安全。
- 重要操作需加日志注解（如`@CommonLog`）便于审计。

## 11. 其他规范

- 严格遵循开源协议和版权声明，不得删除或修改LICENSE及头部版权信息。
- 插件代码应易于扩展和维护，推荐使用设计模式和SOLID原则。

---

如需更详细的模板或示例代码，可进一步补充。你可以根据实际业务需求，对本规范进行适当调整和补充。 